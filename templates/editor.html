{% extends "base.html" %}

{% block title %}Editor â€” bundledb.json{% endblock %}

{% block content %}
<div style="display: flex; align-items: center; margin-top: -1.25rem; margin-bottom: 1.25rem">
    <div style="display: flex; gap: 0.5rem;">
        <a href="/social" class="btn-nav">Social Posting</a>
        <a href="/db-mgmt" class="btn-nav">Database Stats</a>
    </div>
    <h2 style="margin: 0; flex: 1; text-align: center; font-family: var(--font-body)">Bundle Editor</h2>
    <div style="display: flex; gap: 0.5rem; align-items: center;">
        <button type="button" id="btn-check-url-open" class="btn-nav">Check URL</button>
        <button type="button" id="btn-run-latest" class="btn-nav">Run Latest</button>
        <button type="button" id="btn-deploy" class="btn-nav">Deploy</button>
    </div>
</div>
<div class="editor-container">

    <!-- Next Issue -->
    {% if issue_counts %}
    <fieldset id="next-issue-info">
        <legend>Next Issue</legend>
        <span>Issue: <span class="issue-count-num">{{ issue_counts.issue_number }}</span></span>
        <span>Blog Posts: <span class="issue-count-num">{{ issue_counts.blog_posts }}</span></span>
        <span>Sites: <span class="issue-count-num">{{ issue_counts.sites }}</span></span>
        <span>Releases: <span class="issue-count-num">{{ issue_counts.releases }}</span></span>
        <span>Starters: <span class="issue-count-num">{{ issue_counts.starters }}</span></span>
    </fieldset>
    {% endif %}

    <!-- Mode selector -->
    <fieldset id="mode-selector">
        <legend>Mode</legend>
        <label><input type="radio" name="editor-mode" value="create" checked> Create Entry</label>
        <label><input type="radio" name="editor-mode" value="edit"> Edit Entry</label>
        <label><input type="radio" name="editor-mode" value="edit-latest"> Edit Latest Issue</label>
        <label><input type="radio" name="editor-mode" value="generate"> Generate Bundle Issue</label>
    </fieldset>

    <!-- Latest issue summary (shown in edit-latest mode) -->
    <div id="latest-issue-summary" class="issue-counts" style="display:none;"></div>

    <!-- Type selector -->
    <fieldset id="type-selector">
        <legend>Type</legend>
        <label><input type="radio" name="item-type" value="blog post"> Blog Post</label>
        <label><input type="radio" name="item-type" value="site"> Site</label>
        <label><input type="radio" name="item-type" value="release"> Release</label>
        <label><input type="radio" name="item-type" value="starter"> Starter</label>
    </fieldset>

    <!-- Test data warning banner -->
    <div id="test-data-banner" class="test-data-banner" style="display:none;"></div>

    <!-- Content review banner -->
    <div id="content-review-banner" class="content-review-banner" style="display:none;"></div>

    <!-- Content review details modal -->
    <div id="content-review-modal" class="deploy-modal-overlay" style="display:none;">
        <div class="deploy-modal">
            <h3>Content Review Details</h3>
            <div id="content-review-modal-body"></div>
            <button type="button" id="content-review-modal-close" class="btn-action">Close</button>
        </div>
    </div>

    <!-- Search -->
    <fieldset id="search-section" style="display:none;">
        <legend>Search</legend>
        <input type="text" id="search-input" placeholder="Enter search term...">
    </fieldset>

    <!-- Recent items -->
    <div id="recent-items" class="item-list" style="display:none;">
        <h3 id="recent-items-heading" class="latest-issue-heading">Recent</h3>
        <div id="recent-items-list"></div>
    </div>

    <!-- Latest issue items -->
    <div id="latest-issue-items" class="item-list" style="display:none;"></div>

    <!-- Generate issue items -->
    <div id="generate-issue-container" style="display:none;">
        <div id="generate-issue-items"></div>
    </div>

    <!-- Search results -->
    <div id="search-results" class="item-list" style="display:none;">
        <h3 class="list-heading">Results</h3>
        <div id="search-results-list"></div>
    </div>

    <!-- Edit form -->
    <div id="edit-form-container" style="display:none;">
        <fieldset>
            <legend id="edit-form-title">Edit Item</legend>
            <div id="edit-form-fields"></div>
            <div class="edit-actions">
                <button type="button" id="btn-save" class="btn-action">Save</button>
                <button type="button" id="btn-save-end" class="btn-action">Save &amp; Run Latest</button>
                <button type="button" id="btn-save-deploy" class="btn-action">Save &amp; Deploy</button>
                <button type="button" id="btn-view-json" class="btn-action btn-secondary" style="display:none;">View JSON</button>
                <button type="button" id="btn-cancel" class="btn-action btn-secondary">Cancel</button>
            </div>
            <div id="json-preview-panel" style="display:none;"></div>
        </fieldset>
    </div>

    <!-- Status message -->
    <div id="status-message" style="display:none;"></div>

</div>

<!-- Delete confirmation modal -->
<div id="delete-confirm-modal" class="deploy-modal-overlay" style="display:none;">
    <div class="deploy-modal">
        <h3>Confirm Delete</h3>
        <p id="delete-confirm-message"></p>
        <div class="delete-confirm-buttons">
            <button type="button" id="delete-confirm-ok" class="btn-action btn-delete-entry">DELETE</button>
            <button type="button" id="delete-confirm-cancel" class="btn-action btn-secondary">Cancel</button>
        </div>
    </div>
</div>

<!-- Overwrite blog post modal -->
<div id="overwrite-modal" class="deploy-modal-overlay" style="display:none;">
    <div class="deploy-modal">
        <h3>File Already Exists</h3>
        <p id="overwrite-modal-message"></p>
        <div class="delete-confirm-buttons">
            <button type="button" id="overwrite-modal-cancel" class="btn-action btn-secondary">Cancel</button>
            <button type="button" id="overwrite-modal-ok" class="btn-action btn-delete-entry">OVERWRITE</button>
        </div>
    </div>
</div>

<!-- Duplicate link modal -->
<div id="duplicate-link-modal" class="deploy-modal-overlay" style="display:none;">
    <div class="deploy-modal">
        <h3 id="duplicate-link-title">Duplicate Link</h3>
        <p id="duplicate-link-message"></p>
        <button type="button" id="duplicate-link-ok" class="btn-action">Ok</button>
    </div>
</div>

<!-- Deploy output modal -->
<div id="deploy-modal" class="deploy-modal-overlay" style="display:none;">
    <div class="deploy-modal">
        <h3 id="deploy-modal-title">Deploy Output</h3>
        <pre id="deploy-modal-output" class="deploy-modal-output"></pre>
        <div style="display:flex;gap:.5rem;justify-content:flex-end">
            <button type="button" id="deploy-modal-ok" class="btn-action">Ok</button>
            <button type="button" id="deploy-modal-close" class="btn-action" style="display:none">Close</button>
        </div>
    </div>
</div>
<!-- Check URL modal -->
<div id="check-url-modal" class="deploy-modal-overlay" style="display:none;">
    <div class="deploy-modal">
        <h3>Check URL</h3>
        <input type="text" id="check-url-input" placeholder="Enter URL to check..." style="margin-bottom: 0.75rem;">
        <div class="check-url-buttons">
            <button type="button" id="btn-check-url" class="btn-action">Check</button>
            <button type="button" id="check-url-modal-close" class="btn-action btn-secondary">Close</button>
        </div>
        <div id="check-url-result" style="display:none;"></div>
    </div>
</div>
<!-- Run Latest test data warning modal -->
<div id="test-warn-modal" class="deploy-modal-overlay" style="display:none;">
    <div class="deploy-modal">
        <h3>Test Data Present</h3>
        <p>There are test entries (bobDemo99) in the database. Running latest will include test data on the local site.</p>
        <div class="delete-confirm-buttons">
            <button type="button" id="test-warn-proceed" class="btn-action">Proceed</button>
            <button type="button" id="test-warn-cancel" class="btn-action btn-secondary">Cancel</button>
        </div>
    </div>
</div>
<!-- Deploy test data blocked modal -->
<div id="test-deploy-modal" class="deploy-modal-overlay" style="display:none;">
    <div class="deploy-modal">
        <h3>UNABLE TO DEPLOY WHEN TEST DATA IS PRESENT</h3>
        <div class="delete-confirm-buttons">
            <button type="button" id="test-deploy-delete" class="btn-action btn-delete-entry">DELETE TEST ITEMS</button>
            <button type="button" id="test-deploy-close" class="btn-action btn-secondary">Close</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
{% if sveltiacms_prefill %}
<script>window.sveltiacmsPrefill = {{ sveltiacms_prefill | tojson }};</script>
{% endif %}
<script src="{{ url_for('static', filename='js/editor.js') }}?v={{ js_version }}"></script>
{% endblock %}
